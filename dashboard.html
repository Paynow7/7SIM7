<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>接码服务 - 7SIM</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --accent: #4cc9f0;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #4bb543;
            --gray: #6c757d;
            --light-gray: #e9ecef;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fb;
            color: var(--dark);
            line-height: 1.6;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* 导航栏样式 */
        header {
            background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }

        .logo {
            display: flex;
            align-items: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            text-decoration: none;
        }

        .logo i {
            margin-right: 8px;
            font-size: 1.8rem;
        }

        .nav-links {
            display: flex;
            list-style: none;
            align-items: center;
        }

        .nav-links li {
            margin-left: 25px;
        }

        .nav-links a {
            text-decoration: none;
            color: var(--dark);
            font-weight: 500;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: var(--primary);
        }

        .wallet-info {
            display: flex;
            align-items: center;
            margin-right: 15px;
            background-color: var(--light);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 500;
        }

        .wallet-info i {
            margin-right: 8px;
            color: var(--success);
        }

        .btn {
            padding: 8px 20px;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--secondary);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        .user-menu {
            position: relative;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--light-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            margin-left: 15px;
            color: var(--gray);
        }

        .user-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            padding: 10px 0;
            min-width: 180px;
            z-index: 1000;
        }

        .user-dropdown.show {
            display: block;
        }

        .user-dropdown-item {
            padding: 10px 20px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .user-dropdown-item:hover {
            background: var(--light);
        }

        .user-dropdown-item i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        /* 搜索栏样式 */
        .search-section {
            padding: 40px 0;
            background: white;
        }

        .search-container {
            max-width: 600px;
            margin: 0 auto;
        }

        .search-bar {
            position: relative;
            margin-bottom: 20px;
        }

        .search-bar i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }

        .search-bar input {
            width: 100%;
            padding: 12px 15px 12px 45px;
            border: 2px solid var(--light-gray);
            border-radius: 25px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .search-bar input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .search-filters {
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .filter-btn {
            padding: 8px 20px;
            border: 1px solid var(--light-gray);
            background: white;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* 服务网格样式 */
        .services-section {
            padding: 40px 0;
        }

        .section-title {
            text-align: center;
            margin-bottom: 30px;
        }

        .section-title h2 {
            font-size: 2.2rem;
            color: var(--dark);
            margin-bottom: 15px;
        }

        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .service-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s, box-shadow 0.3s;
            text-align: center;
        }

        .service-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .service-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            margin: 0 auto 15px;
            background: var(--light-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--primary);
        }

        .service-flag {
            width: 60px;
            height: 40px;
            object-fit: cover;
            border-radius: 4px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .service-name {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 1.1rem;
        }

        .service-price {
            color: var(--success);
            font-weight: 500;
            font-size: 1.2rem;
            margin-bottom: 15px;
        }

        .service-stock {
            color: var(--gray);
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        /* 模态框样式 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 8px;
            width: 100%;
            max-width: 500px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            font-size: 1.5rem;
            color: var(--dark);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--light-gray);
            border-radius: 4px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            border-color: var(--primary);
            outline: none;
        }

        .api-key-section {
            margin-top: 20px;
            padding: 15px;
            background-color: var(--light);
            border-radius: 8px;
        }

        .api-key-display {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }

        .api-key-value {
            flex-grow: 1;
            padding: 10px;
            background-color: white;
            border: 1px solid var(--light-gray);
            border-radius: 4px;
            font-family: monospace;
            margin-right: 10px;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: var(--gray);
        }

        .no-results i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--light-gray);
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <header>
        <div class="container">
            <div class="navbar">
                <a href="dashboard.html" class="logo">
                    <i class="fas fa-sim-card"></i>
                    <span>7SIM</span>
                </a>
                <ul class="nav-links">
                    <li><a href="#services">接码服务</a></li>
                    <li><a href="#history">使用记录</a></li>
                    <li><a href="#api">API文档</a></li>
                </ul>
                <div class="auth-buttons">
                    <div class="wallet-info">
                        <i class="fas fa-wallet"></i>
                        <span id="balanceAmount">¥0.00</span>
                    </div>
                    <button class="btn btn-primary" id="rechargeBtn">充值</button>
                    <div class="user-menu">
                        <div class="user-avatar" id="userAvatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="user-dropdown" id="userDropdown">
                            <div class="user-dropdown-item" id="apiKeyBtn">
                                <i class="fas fa-key"></i> API密钥
                            </div>
                            <div class="user-dropdown-item">
                                <i class="fas fa-history"></i> 使用记录
                            </div>
                            <div class="user-dropdown-item" id="logoutBtn">
                                <i class="fas fa-sign-out-alt"></i> 退出登录
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- 搜索区域 -->
    <section class="search-section">
        <div class="container">
            <div class="search-container">
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" id="serviceSearch" placeholder="搜索国家或应用...">
                </div>
                <div class="search-filters">
                    <button class="filter-btn active" data-filter="all">全部</button>
                    <button class="filter-btn" data-filter="country">国家</button>
                    <button class="filter-btn" data-filter="app">应用</button>
                </div>
            </div>
        </div>
    </section>

    <!-- 服务区域 -->
    <section class="services-section" id="services">
        <div class="container">
            <div class="section-title">
                <h2>选择接码服务</h2>
                <p>选择您需要的国家或应用获取临时手机号码</p>
            </div>
            <div class="services-grid" id="servicesGrid">
                <!-- 服务卡片会动态加载 -->
            </div>
        </div>
    </section>

    <!-- API密钥模态框 -->
    <div class="modal" id="apiKeyModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>API密钥管理</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="api-key-section">
                <p>您的API密钥用于访问7SIM服务。请妥善保管，不要泄露给他人。</p>
                <div class="api-key-display">
                    <div class="api-key-value" id="apiKeyValue">************************</div>
                    <button class="btn btn-outline" id="showApiKey">显示</button>
                    <button class="btn btn-outline" id="copyApiKey">复制</button>
                </div>
                <button class="btn btn-primary" style="width: 100%; margin-top: 15px;" id="generateApiKey">生成新的API密钥</button>
            </div>
        </div>
    </div>

    <!-- 充值模态框 -->
    <div class="modal" id="rechargeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>账户充值</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div>
                <div class="form-group">
                    <label>选择充值金额</label>
                    <div class="payment-amounts">
                        <div class="amount-option" data-amount="10">¥10</div>
                        <div class="amount-option" data-amount="50">¥50</div>
                        <div class="amount-option" data-amount="100">¥100</div>
                        <div class="amount-option" data-amount="200">¥200</div>
                        <div class="amount-option" data-amount="500">¥500</div>
                        <div class="amount-option" data-amount="1000">¥1000</div>
                    </div>
                </div>
                <div class="form-group">
                    <label>选择支付方式</label>
                    <div class="payment-methods">
                        <div class="payment-method" data-method="alipay">
                            <div class="payment-icon">
                                <i class="fab fa-alipay"></i>
                            </div>
                            <div>支付宝</div>
                        </div>
                        <div class="payment-method" data-method="wechat">
                            <div class="payment-icon">
                                <i class="fab fa-weixin"></i>
                            </div>
                            <div>微信支付</div>
                        </div>
                    </div>
                </div>
                <button type="button" class="btn btn-primary" style="width: 100%;" id="confirmRecharge">确认充值</button>
            </div>
        </div>
    </div>

    <script>
        // Firebase配置（与index.html相同）
        const firebaseConfig = {
            apiKey: "您的API密钥",
            authDomain: "您的项目ID.firebaseapp.com",
            projectId: "您的项目ID",
            storageBucket: "您的项目ID.appspot.com",
            messagingSenderId: "您的发送者ID",
            appId: "您的应用ID"
        };

        // 初始化Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // 加载服务数据
async function loadServices() {
  try {
    const data = await loadAppData();
    const servicesGrid = document.getElementById('servicesGrid');
    servicesGrid.innerHTML = '';
    
    data.services.filter(service => service.active).forEach(service => {
      const card = createServiceCard(service);
      servicesGrid.appendChild(card);
    });
  } catch (error) {
    console.error('加载服务失败:', error);
  }
}

// 加载支付方式
async function loadPaymentMethods() {
  try {
    const data = await loadAppData();
    // 在充值模态框中显示支付方式
    displayPaymentMethods(data.paymentMethods);
  } catch (error) {
    console.error('加载支付方式失败:', error);
  }
}

// 通用数据加载函数
async function loadAppData() {
  try {
    // 从GitHub Raw加载
    const response = await fetch('https://raw.githubusercontent.com/您的用户名/您的仓库名/main/data.json');
    return await response.json();
  } catch (error) {
    console.error('从GitHub加载数据失败:', error);
    // 备用方案：从本地存储加载
    const localData = localStorage.getItem('appData');
    return localData ? JSON.parse(localData) : { services: [], paymentMethods: [] };
  }
}

        // 检查登录状态
        auth.onAuthStateChanged((user) => {
            if (user) {
                if (user.emailVerified) {
                    // 用户已登录且邮箱已验证
                    loadUserData(user.uid);
                    loadServices();
                } else {
                    // 邮箱未验证，跳转回首页
                    alert('请先验证您的邮箱');
                    window.location.href = 'index.html';
                }
            } else {
                // 用户未登录，跳转到首页
                window.location.href = 'index.html';
            }
        });

        // 加载用户数据
        function loadUserData(uid) {
            db.collection('users').doc(uid).get()
                .then((doc) => {
                    if (doc.exists) {
                        const userData = doc.data();
                        // 更新余额显示
                        document.getElementById('balanceAmount').textContent = `¥${userData.balance.toFixed(2)}`;
                    }
                })
                .catch((error) => {
                    console.error('加载用户数据失败:', error);
                });
        }

        // 加载服务列表
        function loadServices() {
            db.collection('services').get()
                .then((querySnapshot) => {
                    const servicesGrid = document.getElementById('servicesGrid');
                    servicesGrid.innerHTML = '';

                    if (querySnapshot.empty) {
                        servicesGrid.innerHTML = `
                            <div class="no-results">
                                <i class="fas fa-inbox"></i>
                                <h3>暂无服务</h3>
                                <p>请联系管理员添加服务</p>
                            </div>
                        `;
                        return;
                    }

                    querySnapshot.forEach((doc) => {
                        const service = doc.data();
                        const serviceCard = createServiceCard(service);
                        servicesGrid.appendChild(serviceCard);
                    });
                })
                .catch((error) => {
                    console.error('加载服务失败:', error);
                });
        }

        // 创建服务卡片
        function createServiceCard(service) {
            const card = document.createElement('div');
            card.className = 'service-card';
            card.dataset.type = service.type;
            card.dataset.name = service.name.toLowerCase();

            let iconHtml = '';
            if (service.type === 'country') {
                iconHtml = `<img src="${service.flag}" alt="${service.name}" class="service-flag">`;
            } else {
                iconHtml = `<div class="service-icon"><i class="${service.icon}"></i></div>`;
            }

            card.innerHTML = `
                ${iconHtml}
                <div class="service-name">${service.name}</div>
                <div class="service-price">¥${service.price}/条</div>
                <div class="service-stock">库存: ${service.stock}个号码</div>
                <button class="btn btn-primary" onclick="selectService('${service.id}')">选择号码</button>
            `;

            return card;
        }

        // 选择服务
        function selectService(serviceId) {
            const user = auth.currentUser;
            if (user) {
                // 检查余额
                db.collection('users').doc(user.uid).get()
                    .then((doc) => {
                        if (doc.exists) {
                            const userData = doc.data();
                            db.collection('services').doc(serviceId).get()
                                .then((serviceDoc) => {
                                    const service = serviceDoc.data();
                                    if (userData.balance >= service.price) {
                                        // 余额足够，分配号码
                                        allocateNumber(serviceId, user.uid);
                                    } else {
                                        alert('余额不足，请先充值');
                                    }
                                });
                        }
                    });
            }
        }

        // 分配号码
        function allocateNumber(serviceId, userId) {
            // 这里实现分配号码的逻辑
            alert('号码分配功能开发中...');
        }

        // 搜索功能
        document.getElementById('serviceSearch').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const filter = document.querySelector('.filter-btn.active').dataset.filter;
            filterServices(searchTerm, filter);
        });

        // 筛选功能
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                const searchTerm = document.getElementById('serviceSearch').value.toLowerCase();
                filterServices(searchTerm, this.dataset.filter);
            });
        });

        function filterServices(searchTerm, filter) {
            const cards = document.querySelectorAll('.service-card');
            cards.forEach(card => {
                const type = card.dataset.type;
                const name = card.dataset.name;
                
                const matchesSearch = name.includes(searchTerm);
                const matchesFilter = filter === 'all' || type === filter;
                
                if (matchesSearch && matchesFilter) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // 模态框功能
        document.getElementById('apiKeyBtn').addEventListener('click', () => {
            document.getElementById('apiKeyModal').style.display = 'flex';
        });

        document.getElementById('rechargeBtn').addEventListener('click', () => {
            document.getElementById('rechargeModal').style.display = 'flex';
        });

        document.querySelectorAll('.close-modal').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.style.display = 'none';
                });
            });
        });

        // API密钥功能
        document.getElementById('showApiKey').addEventListener('click', () => {
            const user = auth.currentUser;
            if (user) {
                getUserApiKey(user.uid).then(apiKey => {
                    if (apiKey) {
                        document.getElementById('apiKeyValue').textContent = apiKey;
                        document.getElementById('showApiKey').textContent = '隐藏';
                        document.getElementById('showApiKey').onclick = () => {
                            document.getElementById('apiKeyValue').textContent = '************************';
                            document.getElementById('showApiKey').textContent = '显示';
                            document.getElementById('showApiKey').onclick = arguments.callee;
                        };
                    }
                });
            }
        });

        // 其他功能保持不变...
        // （复制API密钥、生成新API密钥、充值等功能代码与之前相同）
    </script>
</body>
</html>
